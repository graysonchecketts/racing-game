<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultimate Racing Game</title>
  <style>
    body { margin:0; background:#000; overflow:hidden; font-family:Arial; }
    canvas { background:#222; display:block; margin:0 auto; border:4px solid #fff; }

    #menu, #gameOverScreen {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      background:rgba(0,0,0,0.85); color:white;
    }

    button {
      padding:15px 25px; font-size:22px; border:none; cursor:pointer;
      background:#0af; color:#000; border-radius:10px;
    }

    #carSelect {
      display:flex; gap:20px;
    }

    .carOption {
      width:70px; height:120px; border:3px solid white; cursor:pointer;
    }
  </style>
</head>
<body>

  <!-- Start Menu -->
  <div id="menu">
    <h1>üèéÔ∏è Ultimate Racing Game</h1>
    <h3>Select Your Car:</h3>
    <div id="carSelect">
      <div class="carOption" id="car1" style="background:red"></div>
      <div class="carOption" id="car2" style="background:yellow"></div>
      <div class="carOption" id="car3" style="background:cyan"></div>
    </div>
    <button id="startBtn">Start Game</button>
  </div>

  <!-- Game Over Screen -->
  <div id="gameOverScreen" style="display:none;">
    <h1>üí• Crash!</h1>
    <p id="finalScore"></p>
    <button onclick="location.reload()">Restart</button>
  </div>

  <canvas id="gameCanvas" width="500" height="700"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let score = 0;
    let speed = 5;
    let gameRunning = false;
    let carColor = "red";

    const player = { x:225, y:560, width:50, height:100, dx:0 };

    const obstacles = [];
    const coins = [];
    const powerUps = [];

    let roadOffset = 0;

    /* Embedded Sound Effects (no files needed!) */
    const engineSound = new Audio("data:audio/mp3;base64,SUQzAwAAAAAAF... (shortened)");
    const crashSound = new Audio("data:audio/mp3;base64,SUQzAwAAAAAAF... (shortened)");
    const coinSound = new Audio("data:audio/mp3;base64,SUQzAwAAAAAAF... (shortened)");

    function drawRoad() {
      ctx.fillStyle = "#444";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle = "white";
      for (let i = 0; i < 6; i++) {
        ctx.fillRect(canvas.width/2 - 5, roadOffset + i*150, 10, 60);
      }

      roadOffset += speed;
      if (roadOffset > 150) roadOffset = 0;
    }

    function drawCar() {
      ctx.fillStyle = carColor;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function spawnObstacle() {
      obstacles.push({ x:Math.random()*440, y:-100, width:60, height:60, speed:speed });
    }

    function spawnCoin() {
      coins.push({ x:Math.random()*460+15, y:-50, radius:15, speed:speed });
    }

    function spawnPowerUp() {
      powerUps.push({ x:Math.random()*440, y:-80, width:40, height:40, speed:speed });
    }

    function drawObstacle(o) {
      ctx.fillStyle = "red";
      ctx.fillRect(o.x, o.y, o.width, o.height);
    }

    function drawCoin(c) {
      ctx.fillStyle = "yellow";
      ctx.beginPath(); ctx.arc(c.x, c.y, c.radius, 0, Math.PI*2); ctx.fill();
    }

    function drawPowerUp(p) {
      ctx.fillStyle = "lime";
      ctx.fillRect(p.x, p.y, p.width, p.height);
    }

    function moveObjects() {
      obstacles.forEach(o => o.y += o.speed);
      coins.forEach(c => c.y += c.speed);
      powerUps.forEach(p => p.y += p.speed);
    }

    function detectCollisions() {
      // Obstacles
      for (let o of obstacles) {
        if (player.x < o.x + o.width && player.x + player.width > o.x && player.y < o.y + o.height && player.y + player.height > o.y) {
          crashSound.play();
          endGame();
          return;
        }
      }

      // Coins
      for (let i = coins.length-1; i >= 0; i--) {
        let c = coins[i];
        if (player.x < c.x + c.radius && player.x + player.width > c.x - c.radius && player.y < c.y + c.radius && player.y + player.height > c.y - c.radius) {
          score += 10;
          coinSound.play();
          coins.splice(i, 1);
        }
      }

      // Power-ups
      for (let i = powerUps.length-1; i >= 0; i--) {
        let p = powerUps[i];
        if (player.x < p.x + p.width && player.x + player.width > p.x && player.y < p.y + p.height && player.y + player.height > p.y) {
          speed += 2;
          powerUps.splice(i, 1);
        }
      }
    }

    function updatePlayer() {
      player.x += player.dx;
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    }

    function drawScore() {
      ctx.fillStyle = "white";
      ctx.font = "26px Arial";
      ctx.fillText(`Score: ${score}`, 20, 40);
    }

    let obstacleTimer = 0, coinTimer = 0, powerUpTimer = 0;

    function gameLoop() {
      if (!gameRunning) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      drawRoad();
      drawCar();
      updatePlayer();

      moveObjects();

      obstacles.forEach(drawObstacle);
      coins.forEach(drawCoin);
      powerUps.forEach(drawPowerUp);

      detectCollisions();
      drawScore();

      obstacleTimer++;
      coinTimer++;
      powerUpTimer++;

      if (obstacleTimer > 50) { spawnObstacle(); obstacleTimer = 0; }
      if (coinTimer > 80) { spawnCoin(); coinTimer = 0; }
      if (powerUpTimer > 200) { spawnPowerUp(); powerUpTimer = 0; }

      speed += 0.001;

      requestAnimationFrame(gameLoop);
    }

    function endGame() {
      gameRunning = false;
      finalScore.textContent = `Your Score: ${score}`;
      gameOverScreen.style.display = "flex";
    }

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") player.dx = -8;
      if (e.key === "ArrowRight") player.dx = 8;

      if (engineSound.paused) engineSound.play();
    });

    document.addEventListener("keyup", e => {
      if (e.key === "ArrowLeft" || e.key === "ArrowRight") player.dx = 0;
    });

    document.getElementById("car1").onclick = () => carColor = "red";
    document.getElementById("car2").onclick = () => carColor = "yellow";
    document.getElementById("car3").onclick = () => carColor = "cyan";

    document.getElementById("startBtn").onclick = () => {
      menu.style.display = "none";
      gameRunning = true;
      gameLoop();
    };
  </script>
</body>
</html>
